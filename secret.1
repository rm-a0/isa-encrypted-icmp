.\" File: secret.1
.\" Author: Michal Repcik (xrepcim00)
.TH SECRET 1 "September 27, 2025" "1.0" "User Commands"
.SH NAME
secret \- Transfer files over a covert ICMP/ICMPv6 channel
.SH SYNOPSIS
.B secret
.RB [ -r
.IR file ]
.RB [ -s
.IR ip|hostname ]
.RB [ -l ]

.SH DESCRIPTION
.B secret
is a client/server application that transfers files over a covert channel 
using ICMP/ICMPv6 Echo Request/Reply messages. The file is encrypted with 
AES-256-CBC before transmission, using a key derived from the user’s login. 
The program supports both IPv4 and IPv6, automatically resolving the target address. 
The client sends the file in chunks, with metadata (filename, file size, chunk count, and initialization vector) 
sent first, followed by encrypted data chunks. The server listens for incoming ICMP/ICMPv6 packets, 
reassembles the file, and decrypts it before saving it to the current directory.
.PP
When run with the
.B -l
option, the program operates in server mode, listening for incoming ICMP/ICMPv6 packets. Without
.B -l ,
it operates in client mode, sending the specified file to the target address.
.PP
The program handles files larger than the maximum ICMP payload size (1472 bytes) by splitting them into chunks. 
A custom protocol ensures reliable transmission by including a magic number, version, packet type, 
sequence number, and client ID in each packet.

.SH OPTIONS
.TP
.BR -r " <file>"
Specifies the file to transfer. The file path can be absolute or relative (e.g., ../test.file).
.TP
.BR -s " <ip|hostname>"
Specifies the target IP address or hostname to send the file to. Supports both IPv4 and IPv6 addresses.
.TP
.B -l
Runs the program in server mode, listening for incoming ICMP/ICMPv6 packets and saving the received file to the current directory.

.SH PROTOCOL
The custom protocol used for file transfer includes:
.TP
.B Magic Number
A 32-bit identifier to distinguish valid packets.
.TP
.B Version
A 1-byte field indicating the protocol version.
.TP
.B Packet Type
A 1-byte field containing packet type.
.TP
.B Sequence Number
A 32-bit field for packet ordering.
.TP
.B Client ID
A 64-bit unique identifier for each client session.
.TP
.B Payload
.B Metadata packets: 
filename length (1 byte),
filename (variable length),
file size (32-bit),
total chunks (32-bit),
AES initialization vector (16 bytes).

.B Data packets:  
chunk number (32-bit),
encrypted chunk data.
.PP
The protocol assumes no packet loss, as per the task specification.

.SH ENCRYPTION
The file is encrypted using AES-256-CBC from the OpenSSL library. The encryption key is derived by 
computing the SHA-256 hash of the user’s login, truncated to 32 bytes. A random 16-byte initialization 
vector (IV) is generated for each file transfer and sent in the metadata packet.

.SH EXAMPLES
.TP
Run as client to send a file:
.B secret -r document.txt -s 127.0.0.1
.TP
Run as server to listen for incoming files:
.B secret -l

.SH DIAGNOSTICS
The program outputs error messages to stderr for issues such as:
.IP \(bu 4
Invalid or missing command-line arguments.
.IP \(bu 4
Failure to open or read the input file.
.IP \(bu 4
Failure to resolve the target address or initialize the socket.
.IP \(bu 4
Encryption or decryption failures.
.IP \(bu 4
Packet transmission or reception errors.

.SH NOTES
.TP
The program requires root privileges to create raw sockets and capture ICMP/ICMPv6 packets.
.TP
The program requires C++17 or higher (for std::variant and filesystem)
.TP
The program compilation using provided Maekfile requires GNU Make 3.80 or higher (for wildcards and pattern rules)
.TP
The reference environment for compilation was merlin.fit.vutbr.cz
.TP
The program should be portable across GNU/Linux systems supporting the required libraries (OpenSSL, libpcap, POSIX).
.TP
The maximum payload size per ICMP packet is 1472 bytes, accounting for headers.
.TP
The program uses multithreading in server mode to capture and process packets asynchronously.

.SH EXTENSIONS
.TP
The server can receive packets from multiple clients at the same time.

.SH LIMITATIONS
.TP
Assumes no packet loss; if any expected packet is missing, the server does not create the output file, making large file transfers unreliable in lossy networks.

.SH AUTHOR
Michal Repcik (xrepcim00)